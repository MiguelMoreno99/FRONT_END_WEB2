<div class="titulo-shonen">
  <h1>Partidos</h1>
</div>

<div
  class="container mt-3"
  style="position: fixed; z-index: 1050; top: 20px; right: 20px; width: auto"
>
  @if (mensajeExito) {
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    {{ mensajeExito }}
    <button
      type="button"
      class="btn-close"
      (click)="mensajeExito = ''"
    ></button>
  </div>
  } @if (mensajeError) {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ mensajeError }}
    <button
      type="button"
      class="btn-close"
      (click)="mensajeError = ''"
    ></button>
  </div>
  }
</div>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <section class="top-products">
        <div class="container-options">
          <span
            [class.active]="filtroActual === 'todos'"
            (click)="cambiarFiltro('todos')"
          >
            Todos
          </span>
          @if (userId) {
          <span
            [class.active]="filtroActual === 'favoritos'"
            (click)="cambiarFiltro('favoritos')"
          >
            Favoritos
          </span>
          }
        </div>
        <div class="container-products">
          <div class="card-product" *ngFor="let p of partidosFiltrados">
            <div style="display: none">{{ p.stadiumImage }}</div>
            <div
              class="container-img"
              [ngStyle]="{
                'background-image':
                  'linear-gradient(rgba(0,0,0,0.35), rgba(0,0,0,0.35)), url(' +
                  p.stadiumImage +
                  ')'
              }"
            >
              <div class="button-group">
                <span>
                  <a (click)="abrirModal(p)" style="cursor: pointer"
                    ><i class="fa-regular fa-eye"></i
                  ></a>
                </span>
                @if (userId) {
                <span (click)="toggleFavorito(p.id)" class="btn-heart">
                  <i
                    [class]="
                      esFavorito(p.id)
                        ? 'fa-solid fa-heart'
                        : 'fa-regular fa-heart'
                    "
                    [class.heart-active]="esFavorito(p.id)"
                  >
                  </i>
                </span>
                } @if (userToken) {
                <span (click)="abrirModalEdicion(p)" class="btn-edit">
                  <i class="fa-regular fa-edit"></i>
                </span>
                }
              </div>
            </div>
            <div class="content-card-product">
              <div class="equipos">
                <div class="equipo">
                  <div class="nombre">{{ p.equipoA.nombre }}</div>
                  <div class="goles">{{ p.golesEquipoA }}</div>
                </div>
                <div class="versus">vs</div>
                <div class="equipo">
                  <div class="nombre">{{ p.equipoB.nombre }}</div>
                  <div class="goles">{{ p.golesEquipoB }}</div>
                </div>
              </div>

              <div class="detalles">
                <span class="fecha">{{
                  p.fecha | date : "medium" : "UTC"
                }}</span>
                <span class="estadio">{{ p.estadio || p.ciudad }}</span>
              </div>
            </div>
          </div>
          @if (filtroActual === 'favoritos' && partidosFiltrados.length === 0){
          <div
            class="text-center w-100"
            style="grid-column: 1/-1; color: white"
          >
            <h3>
              No tienes partidos favoritos aún
              <i class="fa-regular fa-face-sad-tear"></i>
            </h3>
          </div>
          }
        </div>
      </section>
    </div>
  </div>
</div>
<!-- Modal para detalles del partido -->
@if (mostrarModal) {
<div class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-content" (click)="prevenirCierre($event)">
    <div class="modal-header">
      <h2>Detalles del Partido</h2>
      <button class="close-button" (click)="cerrarModal()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>
    @if (partidoSeleccionado) {
    <div class="modal-body">
      <!-- Encabezado con equipos y resultado -->
      <div class="modal-equipos">
        <div class="modal-equipo">
          <div class="modal-equipo-nombre">
            {{ partidoSeleccionado.equipoA.nombre }}
          </div>
          <div class="modal-goles">{{ partidoSeleccionado.golesEquipoA }}</div>
        </div>
        <div class="modal-vs">VS</div>
        <div class="modal-equipo">
          <div class="modal-equipo-nombre">
            {{ partidoSeleccionado.equipoB.nombre }}
          </div>
          <div class="modal-goles">{{ partidoSeleccionado.golesEquipoB }}</div>
        </div>
      </div>

      <!-- Información detallada -->
      <div class="modal-info-grid">
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-calendar"></i> Fecha:</span
          >
          <span class="info-value">{{
            partidoSeleccionado.fecha | date : "fullDate" : "UTC"
          }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-clock"></i> Hora:</span
          >
          <span class="info-value">{{
            partidoSeleccionado.fecha | date : "shortTime" : "UTC"
          }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-location-dot"></i> Estadio:</span
          >
          <span class="info-value">{{ partidoSeleccionado.estadio }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-city"></i> Ciudad:</span
          >
          <span class="info-value">{{ partidoSeleccionado.ciudad }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-diagram-project"></i> Fase:</span
          >
          <span class="info-value">{{ partidoSeleccionado.fase }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-people-group"></i> Grupo:</span
          >
          <span class="info-value">{{ partidoSeleccionado.grupo }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-whistle"></i> Árbitro:</span
          >
          <span class="info-value">{{
            partidoSeleccionado.arbitroPrincipal
          }}</span>
        </div>
        <div class="info-item">
          <span class="info-label"
            ><i class="fa-solid fa-flag"></i> Estado:</span
          >
          <span class="info-value">{{ partidoSeleccionado.estado }}</span>
        </div>
      </div>

      <!-- Información de equipos -->
      <div class="equipos-detalle">
        <div class="equipo-detalle">
          <h4>{{ partidoSeleccionado.equipoA.nombre }}</h4>
          <p>
            <strong>País:</strong>
            {{ partidoSeleccionado.equipoA.nombreCompletoPais }}
          </p>
          <p>
            <strong>Ranking FIFA:</strong>
            {{ partidoSeleccionado.equipoA.rankingFifa || "N/A" }}
          </p>
        </div>
        <div class="equipo-detalle">
          <h4>{{ partidoSeleccionado.equipoB.nombre }}</h4>
          <p>
            <strong>País:</strong>
            {{ partidoSeleccionado.equipoB.nombreCompletoPais }}
          </p>
          <p>
            <strong>Ranking FIFA:</strong>
            {{ partidoSeleccionado.equipoB.rankingFifa || "N/A" }}
          </p>
        </div>
      </div>
    </div>
    }
  </div>
</div>
}
<!-- Modal para edición del partido -->
@if (mostrarModalEdicion) {
<div class="modal-overlay modal-edicion" (click)="cerrarModalEdicion()">
  <div
    class="modal-content modal-edicion-content"
    (click)="prevenirCierre($event)"
    [formGroup]="formularioEdicion"
  >
    <div class="modal-header">
      <h2>
        <i class="fa-regular fa-edit" style="margin-right: 10px"></i>
        Editar Partido
      </h2>
      <button class="close-button" (click)="cerrarModalEdicion()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <!-- Información de equipos (solo lectura) -->
      <div class="marcador-visualizacion" style="margin-bottom: 2rem">
        <div class="marcador-header">
          <h3 style="color: goldenrod; text-align: center; margin-bottom: 20px;">
            <i class="fa-solid fa-scoreboard me-2"></i> Marcador
          </h3>
        </div>
        
        <div class="marcador-equipos">
          <!-- Equipo A -->
          <div class="equipo-info">
            <div class="equipo-nombre">
              <h4 style="color: #4CAF50;">
                {{ partidoEditando?.equipoA?.nombre }}
              </h4>
            </div>
            <div class="equipo-goles">
              <div class="goles-display">
                <span class="goles-numero">
                  {{ partidoEditando?.golesEquipoA || 0 }}
                </span>
              </div>
            </div>
          </div>
          
          <!-- Separador -->
          <div class="marcador-separador">
            <span style="color: goldenrod; font-size: 2rem; font-weight: bold;">VS</span>
          </div>
          
          <!-- Equipo B -->
          <div class="equipo-info">
            <div class="equipo-nombre">
              <h4 style="color: #2196F3;">
                {{ partidoEditando?.equipoB?.nombre }}
              </h4>
            </div>
            <div class="equipo-goles">
              <div class="goles-display">
                <span class="goles-numero">
                  {{ partidoEditando?.golesEquipoB || 0 }}
                </span>
              </div>
            </div>
          </div>
        </div>
        

      <!-- Formulario de edición -->
      <div class="formulario-edicion">
        <div class="form-grid">
          <!-- Columna 1 -->
          <div class="form-group">
            <label for="fecha">
              <i class="fa-solid fa-calendar"></i> Fecha 
            </label>
            <input
              type="date"
              id="fecha"
              formControlName="fecha"
              class="form-input"
              [class.is-invalid]="tieneError('fecha', 'required')"
            />
            @if (tieneError('fecha', 'required')){
            <div class="error-message">La fecha es requerida</div>
            }
          </div>

          <div class="form-group">
            <label for="estadio">
              <i class="fa-solid fa-location-dot"></i> Estadio 
            </label>
            <input
              type="text"
              id="estadio"
              formControlName="estadio"
              class="form-input"
              placeholder="Nombre del estadio"
              [class.is-invalid]="tieneError('estadio', 'required')"
            />
            @if (tieneError('estadio', 'required')) {
            <div class="error-message">El estadio es requerido</div>
            }
          </div>

          <div class="form-group">
            <label for="ciudad">
              <i class="fa-solid fa-city"></i> Ciudad *
            </label>
            <input
              type="text"
              id="ciudad"
              formControlName="ciudad"
              class="form-input"
              placeholder="Ciudad"
              [class.is-invalid]="tieneError('ciudad', 'required')"
            />
            @if (tieneError('ciudad', 'required')){
            <div class="error-message">La ciudad es requerida</div>
            }
          </div>

          <!-- Columna 2 -->
          <div class="form-group">
            <label for="fase">
              <i class="fa-solid fa-diagram-project"></i> Fase *
            </label>
            <select
              id="fase"
              formControlName="fase"
              class="form-select"
              [class.is-invalid]="tieneError('fase', 'required')"
            >
              <option value="">Seleccionar fase</option>
              <option *ngFor="let fase of fases" [value]="fase">
                {{ fase }}
              </option>
            </select>
            @if (tieneError('fase', 'required')) {
            <div class="error-message">La fase es requerida</div>
            }
          </div>

          <div class="form-group">
            <label for="grupo">
              <i class="fa-solid fa-people-group"></i> Grupo
            </label>
            <select id="grupo" formControlName="grupo" class="form-select">
              <option value="">Sin grupo</option>
              <option *ngFor="let grupo of grupos" [value]="grupo">
                Grupo {{ grupo }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="arbitro">
              <i class="fa-solid fa-whistle"></i> Árbitro Principal
            </label>
            <input
              type="text"
              id="arbitro"
              formControlName="arbitroPrincipal"
              class="form-input"
              placeholder="Nombre del árbitro"
            />
          </div>

          <!-- Estado (full width) -->
          <div class="form-group full-width">
            <label for="estado">
              <i class="fa-solid fa-flag"></i> Estado del Partido *
            </label>
            <div class="estado-options">
              <label *ngFor="let estado of estados" class="estado-option">
                <input type="radio" formControlName="estado" [value]="estado" />
                <span
                  class="estado-badge"
                  [class.selected]="
                    formularioEdicion.get('estado')?.value === estado
                  "
                >
                  {{ estado }}
                </span>
              </label>
            </div>
            @if (tieneError('estado', 'required')){
            <div class="error-message">El estado es requerido</div>
            }
          </div>
        </div>

        <!-- Botones de acción -->
        <div class="modal-actions">
          <button
            type="button"
            class="btn-cancelar"
            (click)="cerrarModalEdicion()"
          >
            <i class="fa-solid fa-times"></i> Cancelar
          </button>
          <button
            type="button"
            class="btn-guardar"
            (click)="guardarCambios()"
            [disabled]="formularioEdicion.invalid"
          >
            <i class="fa-solid fa-save"></i> Guardar Cambios
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
}
