<div class="container mt-5 mb-5">
  <div class="card shadow-lg">
    <div
      class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
    >
      <h3 class="mb-0"><i class="fa-solid fa-id-card me-2"></i> Mi Perfil</h3>
      <div>
        @if (usuarioActual?.usuario?.rol === 'admin') {
        <button class="btn btn-info btn-sm me-2" (click)="abrirModalPartido()">
          <i class="fa-solid fa-plus"></i> Nuevo Partido
        </button>
        <button class="btn btn-info btn-sm me-2" (click)="abrirModalEquipo()">
          <i class="fa-solid fa-plus"></i> Nuevo Equipo
        </button>
         <button class="btn btn-info btn-sm me-2" (click)="abrirModalMarcador()">
          <i class="fa-solid fa-plus"></i> Actualilzar Marcador
        </button>
        }
        <button class="btn btn-danger btn-sm" (click)="cerrarSesion()">
          <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesión
        </button>
      </div>
    </div>

    <div class="card-body p-4">
      @if (!(mostrarModalPartido || mostrarModalEquipo)) { @if (mensajeExito) {
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        {{ mensajeExito }}
        <button
          type="button"
          class="btn-close"
          (click)="mensajeExito = ''"
        ></button>
      </div>
      } @if (mensajeError) {
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ mensajeError }}
        <button
          type="button"
          class="btn-close"
          (click)="mensajeError = ''"
        ></button>
      </div>
      } }

      <!-- Contenido principal -->
      @if (!isEditando) {
      <div class="row info-lectura">
        <div class="col-md-4 text-center mb-3">
          <img
            src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
            alt="User Avatar"
            class="img-fluid rounded-circle"
            style="max-width: 150px"
          />
          <h4 class="mt-3">
            {{ usuarioActual?.usuario?.nombre }}
            {{ usuarioActual?.usuario?.apellido }}
          </h4>
          <span class="badge bg-secondary">{{
            usuarioActual?.usuario?.rol | uppercase
          }}</span>
        </div>

        <div class="col-md-8">
          <h5 class="border-bottom pb-2">Información Personal</h5>

          <div class="mb-3 row">
            <label class="col-sm-4 fw-bold">Correo Electrónico:</label>
            <div class="col-sm-8">{{ usuarioActual?.usuario?.correo }}</div>
          </div>

          <div class="mb-3 row">
            <label class="col-sm-4 fw-bold">Fecha de Nacimiento:</label>
            <div class="col-sm-8">
              {{
                usuarioActual?.usuario?.fechaNacimiento
                  | date : "longDate" : "UTC"
              }}
            </div>
          </div>

          <div class="mb-3 row">
            <label class="col-sm-4 fw-bold">Miembro desde:</label>
            <div class="col-sm-8">
              {{
                usuarioActual?.usuario?.fechaRegistro
                  | date : "mediumDate" : "UTC"
              }}
            </div>
          </div>

          <div class="d-flex justify-content-end mt-4 gap-2">
            <button
              class="btn btn-outline-danger"
              (click)="confirmarEliminacion()"
            >
              <i class="fa-solid fa-trash"></i> Eliminar Cuenta
            </button>
            <button class="btn btn-warning" (click)="activarEdicion()">
              <i class="fa-solid fa-pen-to-square"></i> Editar Información
            </button>
          </div>
        </div>
      </div>
      } @else {
      <!-- Formulario de edición de perfil -->
      <form [formGroup]="perfilForm" (ngSubmit)="guardarCambios()">
        <h5 class="mb-4 text-primary">Editar Información</h5>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input
              type="text"
              id="nombre"
              class="form-control"
              formControlName="nombre"
              [class.is-invalid]="
                perfilForm.get('nombre')?.invalid &&
                perfilForm.get('nombre')?.touched
              "
            />
            @if(perfilForm.get('nombre')?.hasError('required')) {
            <div class="invalid-feedback">El nombre es obligatorio.</div>
            } @else if(perfilForm.get('nombre')?.hasError('invalidName')) {
            <div class="invalid-feedback">
              El nombre no debe contener carácteres especiales ni numeros.
            </div>
            }
          </div>

          <div class="col-md-6 mb-3">
            <label for="apellido" class="form-label">Apellido</label>
            <input
              type="text"
              id="apellido"
              class="form-control"
              formControlName="apellido"
              [class.is-invalid]="
                perfilForm.get('apellido')?.invalid &&
                perfilForm.get('apellido')?.touched
              "
            />
            @if(perfilForm.get('apellido')?.hasError('required')) {
            <div class="invalid-feedback">El apellido es obligatorio.</div>
            }@else if(perfilForm.get('apellido')?.hasError('invalidName')) {
            <div class="invalid-feedback">
              El apellido no debe contener carácteres especiales ni numeros.
            </div>
            }
          </div>
        </div>

        <div class="mb-3">
          <label for="fechaNacimiento" class="form-label"
            >Fecha de Nacimiento</label
          >
          <input
            type="date"
            id="fechaNacimiento"
            class="form-control"
            formControlName="fechaNacimiento"
            [class.is-invalid]="
              perfilForm.get('fechaNacimiento')?.invalid &&
              perfilForm.get('fechaNacimiento')?.touched
            "
          />
          @if(perfilForm.get('fechaNacimiento')?.hasError('required')) {
          <div class="invalid-feedback">
            La fecha de nacimiento es obligatoria.
          </div>
          }@else if(perfilForm.get('fechaNacimiento')?.hasError('fechaFutura'))
          {
          <div class="invalid-feedback">
            La fecha de nacimiento debe ser menor a la fecha actual.
          </div>
          }
        </div>

        <div class="mb-3">
          <label for="correo" class="form-label">Correo Electrónico</label>
          <input
            type="email"
            id="correo"
            class="form-control bg-light"
            formControlName="correo"
            readonly
          />
          <small class="text-muted"
            >El correo no se puede modificar por seguridad.</small
          >
        </div>

        <div class="d-flex justify-content-end gap-2 mt-4">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="cancelarEdicion()"
          >
            Cancelar
          </button>
          <button type="submit" class="btn btn-success">
            <i class="fa-solid fa-save"></i> Guardar Cambios
          </button>
        </div>
      </form>
      }
    </div>
  </div>
</div>

@if (mostrarModalPartido){
<div class="modal-overlay" (click)="cerrarModalPartido()">
  <div
    class="modal-content"
    (click)="prevenirCierre($event)"
    [formGroup]="partidoForm"
  >
    <div class="modal-header">
      <h2><i class="fa-solid fa-futbol me-2"></i> Nuevo Partido</h2>
      <button class="close-button" (click)="cerrarModalPartido()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    @if (mensajeExito) {
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ mensajeExito }}
      <button
        type="button"
        class="btn-close"
        (click)="mensajeExito = ''"
      ></button>
    </div>
    } @if (mensajeError) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {{ mensajeError }}
      <button
        type="button"
        class="btn-close"
        (click)="mensajeError = ''"
      ></button>
    </div>
    }

    <div class="modal-body">
      <div class="form-grid">
        <!-- Fecha -->
        <div class="form-group">
          <label for="fechaPartido">
            <i class="fa-solid fa-calendar"></i> Fecha *
          </label>
          <input
            type="date"
            id="fechaPartido"
            formControlName="fechaPartido"
            class="form-input"
            [class.is-invalid]="
              partidoForm.get('fechaPartido')?.invalid &&
              partidoForm.get('fechaPartido')?.touched
            "
          />
          @if(partidoForm.get('fechaPartido')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> La fecha del partido
            es obligatoria.
          </label>
          }@else if(partidoForm.get('fechaPartido')?.hasError('fechaAnterior'))
          {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> La fecha del partido
            debe ser mayor o igual a la fecha actual.
          </label>
          }
        </div>

        <!-- Hora -->
        <div class="form-group">
          <label for="HoraPartido">
            <i class="fa-solid fa-clock-o"></i> Hora *
          </label>
          <input
            type="time"
            id="horaPartido"
            formControlName="horaPartido"
            class="form-input"
            [class.is-invalid]="
              partidoForm.get('horaPartido')?.invalid &&
              partidoForm.get('horaPartido')?.touched
            "
          />
          @if(partidoForm.get('horaPartido')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> La hora del partido
            es obligatoria.
          </label>
          }@else if(partidoForm.get('horaPartido')?.hasError('horaFutura')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> La hora del partido
            debe ser mayor a la hora actual.
          </label>
          }
        </div>

        <!-- Estadio y Ciudad -->
        <div class="form-group">
          <label for="estadio">
            <i class="fa-solid fa-location-dot"></i> Estadio *
          </label>
          <input
            type="text"
            id="estadio"
            formControlName="estadio"
            class="form-input"
            placeholder="Nombre del estadio"
            [class.is-invalid]="
              partidoForm.get('estadio')?.invalid &&
              partidoForm.get('estadio')?.touched
            "
          />
          @if(partidoForm.get('estadio')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> El nombre del Estadio
            es obligatorio.
          </label>
          }
        </div>

        <div class="form-group">
          <label for="ciudad">
            <i class="fa-solid fa-city"></i> Ciudad *
          </label>
          <input
            type="text"
            id="ciudad"
            formControlName="ciudad"
            class="form-input"
            placeholder="Ciudad"
            [class.is-invalid]="
              partidoForm.get('ciudad')?.invalid &&
              partidoForm.get('ciudad')?.touched
            "
          />
          @if(partidoForm.get('ciudad')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> El nombre de la
            Ciudad es obligatorio.
          </label>
          }
        </div>

        <!-- Equipos -->
        <div class="form-group">
          <label for="equipoA">
            <i class="fa-solid fa-flag"></i> EquipoA *
          </label>
          <select
            id="equipoA"
            formControlName="equipoA"
            class="form-select"
            [class.is-invalid]="
              partidoForm.get('equipoA')?.invalid &&
              partidoForm.get('equipoA')?.touched
            "
          >
            <option value="">Seleccionar equipo</option>
            <option
              *ngFor="let equipo of equiposDisponibles"
              [value]="equipo.id"
            >
              {{ equipo.nombre }}
            </option>
          </select>
          @if(partidoForm.get('equipoA')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Seleccione el Equipo
            A.
          </label>
          }
        </div>

        <div class="form-group">
          <label for="equipoB">
            <i class="fa-solid fa-flag"></i> EquipoB *
          </label>
          <select
            id="equipoB"
            formControlName="equipoB"
            class="form-select"
            [class.is-invalid]="
              partidoForm.get('equipoB')?.invalid &&
              partidoForm.get('equipoB')?.touched
            "
          >
            <option value="">Seleccionar equipo</option>
            <option
              *ngFor="let equipo of equiposDisponibles"
              [value]="equipo.id"
            >
              {{ equipo.nombre }}
            </option>
          </select>
          @if(partidoForm.get('equipoB')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Seleccione el Equipo
            B.
          </label>
          }@else if(partidoForm.get('equipoB')?.hasError('repetido')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> El Equipo no se debe
            repetir.
          </label>
          }
        </div>

        <!-- Fase y Grupo -->
        <div class="form-group">
          <label for="fase">
            <i class="fa-solid fa-diagram-project"></i> Fase *
          </label>
          <select
            id="fase"
            formControlName="fase"
            class="form-select"
            [class.is-invalid]="
              partidoForm.get('fase')?.invalid &&
              partidoForm.get('fase')?.touched
            "
          >
            <option value="">Seleccionar fase</option>
            <option *ngFor="let fase of fases" [value]="fase">
              {{ fase }}
            </option>
          </select>
          @if(partidoForm.get('fase')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Seleccione la Fase.
          </label>
          }
        </div>

        <div class="form-group">
          <label for="grupo">
            <i class="fa-solid fa-people-group"></i> Grupo
          </label>
          <select id="grupo" formControlName="grupo" class="form-select">
            <option value="">Sin grupo</option>
            <option *ngFor="let grupo of grupos" [value]="grupo">
              Grupo {{ grupo }}
            </option>
          </select>
        </div>

        <!-- Árbitro y Estado -->
        <div class="form-group">
          <label for="arbitroPrincipal">
            <i class="fa-solid fa-whistle"></i> Árbitro Principal
          </label>
          <input
            type="text"
            id="arbitroPrincipal"
            formControlName="arbitroPrincipal"
            class="form-input"
            placeholder="Nombre del árbitro"
          />
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="modal-actions">
        <button
          type="button"
          class="btn-cancelar"
          (click)="cerrarModalPartido()"
        >
          <i class="fa-solid fa-times"></i> Cancelar
        </button>
        <button type="button" class="btn-guardar" (click)="guardarPartido()">
          <i class="fa-solid fa-save"></i> Crear Partido
        </button>
      </div>
    </div>
  </div>
</div>
} @if (mostrarModalEquipo){
<div class="modal-overlay" (click)="cerrarModalEquipo()">
  <div
    class="modal-content"
    (click)="prevenirCierre($event)"
    [formGroup]="equipoForm"
  >
    <div class="modal-header">
      <h2><i class="fa-solid fa-users me-2"></i> Nuevo Equipo</h2>
      <button class="close-button" (click)="cerrarModalEquipo()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    @if (mensajeExito) {
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ mensajeExito }}
      <button
        type="button"
        class="btn-close"
        (click)="mensajeExito = ''"
      ></button>
    </div>
    } @if (mensajeError) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {{ mensajeError }}
      <button
        type="button"
        class="btn-close"
        (click)="mensajeError = ''"
      ></button>
    </div>
    }

    <div class="modal-body">
      <!-- Información básica del equipo -->
      <div class="form-grid">
        <div class="form-group">
          <label for="nombreEquipo">
            <i class="fa-solid fa-flag"></i> Nombre *
          </label>
          <input
            type="text"
            id="nombreEquipo"
            formControlName="nombreEquipo"
            class="form-input"
            placeholder="Ej: Argentina"
            [class.is-invalid]="
              equipoForm.get('nombreEquipo')?.invalid &&
              equipoForm.get('nombreEquipo')?.touched
            "
          />
          @if(equipoForm.get('nombreEquipo')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Ingrese el Nombre del
            Equipo.
          </label>
          } @else if(equipoForm.get('nombreEquipo')?.hasError('pattern')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Solo se permiten
            letras.
          </label>
          }
        </div>

        <div class="form-group">
          <label for="nombreCompleto">
            <i class="fa-solid fa-globe"></i> Nombre País Completo *
          </label>
          <input
            type="text"
            id="nombreCompleto"
            formControlName="nombreCompleto"
            class="form-input"
            placeholder="Ej: República Argentina"
            [class.is-invalid]="
              equipoForm.get('nombreCompleto')?.invalid &&
              equipoForm.get('nombreCompleto')?.touched
            "
          />
          @if(equipoForm.get('nombreCompleto')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Ingrese el Nombre del
            del Páis Completo.
          </label>
          } @else if(equipoForm.get('nombreCompleto')?.hasError('pattern')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Solo se permiten
            letras.
          </label>
          }
        </div>

        <div class="form-group">
          <label for="siglas">
            <i class="fa-solid fa-font"></i> Siglas (3 letras) *
          </label>
          <input
            type="text"
            id="siglasEquipo"
            formControlName="siglasEquipo"
            class="form-input"
            maxlength="3"
            placeholder="Ej: ARG"
            (input)="onSiglasInput($event)"
            [class.is-invalid]="
              equipoForm.get('siglasEquipo')?.invalid &&
              equipoForm.get('siglasEquipo')?.touched
            "
          />
          @if(equipoForm.get('siglasEquipo')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Ingrese las Siglas
            del Equipo.
          </label>
          } @else if(equipoForm.get('siglasEquipo')?.hasError('minlength') ||
          equipoForm.get('siglasEquipo')?.hasError('maxlength')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Deben ser Exactamente
            3 letras.
          </label>
          } @else if(equipoForm.get('siglasEquipo')?.hasError('pattern')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Solo se permiten
            letras (A-Z).
          </label>
          }
        </div>

        <div class="form-group">
          <label for="bandera">
            <a href="https://flagpedia.net/index" target="_blank"
              ><i class="fa-solid fa-globe"></i> URL Bandera *</a
            >
          </label>
          <input
            type="url"
            id="bandera"
            formControlName="bandera"
            class="form-input"
            placeholder="https://flagcdn.com/us.svg"
            [class.is-invalid]="
              equipoForm.get('bandera')?.invalid &&
              equipoForm.get('bandera')?.touched
            "
          />
          @if(equipoForm.get('bandera')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Ingrese la URL de la
            Bandera.
          </label>
          } @else if(equipoForm.get('bandera')?.hasError('pattern')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Se requiere una URL
            válida de imagen (https://flagcdn.com/...).
          </label>
          }
        </div>

        <div class="form-group">
          <label for="grupoEquipo">
            <i class="fa-solid fa-people-group"></i> Grupo *
          </label>
          <select
            id="grupoEquipo"
            formControlName="grupoEquipo"
            class="form-select"
            [class.is-invalid]="
              equipoForm.get('grupoEquipo')?.invalid &&
              equipoForm.get('grupoEquipo')?.touched
            "
          >
            <option value="">Seleccionar grupo</option>
            <option *ngFor="let grupo of grupos" [value]="grupo">
              Grupo {{ grupo }}
            </option>
          </select>
          @if(equipoForm.get('grupoEquipo')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Selecione el Grupo
            del Equipo.
          </label>
          }
        </div>

        <div class="form-group">
          <label for="ranking">
            <i class="fa-solid fa-ranking-star"></i> Ranking FIFA *
          </label>
          <input
            type="number"
            id="rankingFifa"
            formControlName="rankingFifa"
            class="form-input"
            [class.is-invalid]="
              equipoForm.get('rankingFifa')?.invalid &&
              equipoForm.get('rankingFifa')?.touched
            "
          />
          @if(equipoForm.get('rankingFifa')?.hasError('required')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Ingrese el numero de
            Ranking.
          </label>
          } @if(equipoForm.get('rankingFifa')?.hasError('min') ||
          equipoForm.get('rankingFifa')?.hasError('max')) {
          <label>
            <i class="fa-solid fa-exclamation-circle"></i> Debe ser un número
            entre 1 y 211.
          </label>
          }
        </div>

        <div class="form-group full-width">
          <label for="informacion">
            <i class="fa-solid fa-info-circle"></i> Información Adicional
          </label>
          <textarea
            id="informacion"
            formControlName="informacion"
            class="form-textarea"
            rows="3"
            placeholder="Historia, logros, datos interesantes..."
          ></textarea>
        </div>
      </div>

      <!-- Jugadores -->
      <div class="seccion-jugadores">
        <h3>
          <i class="fa-solid fa-shirt"></i> Jugadores
          <button type="button" class="btn-agregar" (click)="agregarJugador()">
            <i class="fa-solid fa-plus"></i> Agregar Jugador
          </button>
        </h3>

        <div formArrayName="jugadores" class="jugadores-lista">
          <div
            *ngFor="let jugador of jugadoresArray.controls; let i = index"
            [formGroupName]="i"
            class="jugador-formulario"
          >
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h6 class="text-warning m-0">Jugador #{{ i + 1 }}</h6>
              <button
                type="button"
                class="btn btn-outline-danger btn-sm"
                (click)="removerJugador(i)"
              >
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>

            <div class="form-grid-jugador">
              <div class="form-group">
                <label>Nombre *</label>
                <input
                  type="text"
                  formControlName="nombre"
                  id="nombre"
                  class="form-input"
                  placeholder="Nombre"
                  [class.is-invalid]="
                    jugador.get('nombre')?.invalid &&
                    jugador.get('nombre')?.touched
                  "
                />
                @if(jugador.get('nombre')?.hasError('required')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i> Ingrese el
                  Nombre del Jugador.
                </label>
                } @else if(jugador.get('nombre')?.hasError('pattern')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i> Solo se
                  permiten letras.
                </label>
                }
              </div>

              <div class="form-group">
                <label>Apellido *</label>
                <input
                  type="text"
                  formControlName="apellido"
                  id="apellido"
                  class="form-input"
                  placeholder="Apellido"
                  [class.is-invalid]="
                    jugador.get('apellido')?.invalid &&
                    jugador.get('apellido')?.touched
                  "
                />
                @if(jugador.get('apellido')?.hasError('required')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i> Ingrese el
                  Apellido del Jugador.
                </label>
                } @else if(jugador.get('apellido')?.hasError('pattern')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i> Solo se
                  permiten letras.
                </label>
                }
              </div>

              <div class="form-group">
                <label>Número *</label>
                <input
                  type="number"
                  formControlName="numeroCamiseta"
                  id="numeroCamiseta"
                  class="form-input"
                  placeholder="#"
                  [class.is-invalid]="
                    jugador.get('numeroCamiseta')?.invalid &&
                    jugador.get('numeroCamiseta')?.touched
                  "
                />
                @if(jugador.get('numeroCamiseta')?.hasError('required')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i> Ingrese el
                  Numero del Jugador.
                </label>
                }@else if(jugador.get('numeroCamiseta')?.hasError('min') ||
                jugador.get('numeroCamiseta')?.hasError('max')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i> Solo se
                  permiten numero entre 1 y 999.
                </label>
                }
              </div>

              <div class="form-group">
                <label>Posición *</label>
                <select
                  formControlName="posicion"
                  id="posicion"
                  class="form-select"
                  [class.is-invalid]="
                    jugador.get('posicion')?.invalid &&
                    jugador.get('posicion')?.touched
                  "
                >
                  <option value="">Seleccionar</option>
                  <option
                    *ngFor="let posicion of posiciones"
                    [value]="posicion"
                  >
                    {{ posicion }}
                  </option>
                </select>
                @if(jugador.get('posicion')?.hasError('required')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i> Ingrese la
                  posicion del Jugador.
                </label>
                }
              </div>

              <div class="form-group">
                <label>Fecha de Nacimiento *</label>
                <input
                  type="date"
                  formControlName="fechaNacimiento"
                  id="fechaNacimiento"
                  class="form-input"
                  [class.is-invalid]="
                    jugador.get('fechaNacimiento')?.invalid &&
                    jugador.get('fechaNacimiento')?.touched
                  "
                />
                @if(jugador.get('fechaNacimiento')?.hasError('required')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i>La fecha de
                  nacimiento es obligatoria.
                </label>
                } @if(jugador.get('fechaNacimiento')?.hasError('fechaFutura')) {
                <label>
                  <i class="fa-solid fa-exclamation-circle"></i>La fecha de
                  nacimiento debe ser menor a la fecha actual.
                </label>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="modal-actions">
      <button type="button" class="btn-cancelar" (click)="cerrarModalEquipo()">
        <i class="fa-solid fa-times"></i> Cancelar
      </button>
      <button type="button" class="btn-guardar" (click)="guardarEquipo()">
        <i class="fa-solid fa-save"></i> Crear Equipo
      </button>
    </div>
  </div>
</div>
}

@if (mostrarModalMarcador){
<div class="modal-overlay" (click)="cerrarModalMarcador()">
  <div class="modal-content" (click)="prevenirCierre($event)">
    <div class="modal-header">
      <h2><i class="fa-solid fa-futbol me-2"></i> 
        {{ partidoSeleccionado ? 'Actualizar Marcador' : 'Seleccionar Partido' }}
      </h2>
      <button class="close-button" (click)="cerrarModalMarcador()">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    @if (mensajeExito) {
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ mensajeExito }}
      <button type="button" class="btn-close" (click)="mensajeExito = ''"></button>
    </div>
    }
    
    @if (mensajeError) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {{ mensajeError }}
      <button type="button" class="btn-close" (click)="mensajeError = ''"></button>
    </div>
    }

    <div class="modal-body">
      <!-- Lista de partidos (cuando no hay partido seleccionado) -->
      @if (!partidoSeleccionado) {
      <div class="partidos-lista">
        <h3 class="mb-3 text-center" style="color: goldenrod;">
          <i class="fa-solid fa-list me-2"></i>Partidos Disponibles
        </h3>
        
        @if (partidosDisponibles.length === 0) {
        <div class="sin-partidos text-center p-4">
          <i class="fa-solid fa-calendar-times fa-3x mb-3" style="color: #888;"></i>
          <p class="text-muted">No hay partidos disponibles para editar marcador.</p>
        </div>
        } @else {
        <div class="table-responsive">
          <!-- En la tabla de partidos (cuando no hay partido seleccionado) -->
          <table class="table table-dark table-hover">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Equipo A</th>
                <th>Equipo B</th>
                <th>Estadio</th>
                <th>Estado</th>
                <th>Marcador</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody>
              @for (partido of partidosDisponibles; track partido.id) {
              <tr>
                <td>{{ formatearFecha(partido.fecha) }}</td>
                <!-- CORRECCIÓN: Pasar el ID, no el objeto completo -->
                <td>{{ getNombreEquipo(partido.equipoA.id) }}</td>
                <td>{{ getNombreEquipo(partido.equipoB.id) }}</td>
                <td>{{ partido.estadio }}</td>
                <td>
                  <span class="badge" 
                        [ngClass]="{
                          'bg-warning': partido.estado === 'PROGRAMADO',
                          'bg-success': partido.estado === 'EN_CURSO',
                          'bg-secondary': partido.estado === 'FINALIZADO'
                        }">
                    {{ getEstadoPartido(partido.estado) }}
                  </span>
                </td>
                <td>
                  <!-- CORRECCIÓN: golesEquipoA y golesEquipoB -->
                  {{ partido.golesEquipoA || 0 }} - {{ partido.golesEquipoB || 0 }}
                </td>
                <td>
                  <button class="btn btn-sm btn-outline-warning" 
                          (click)="seleccionarPartido(partido)"
                          [disabled]="partido.estado === 'FINALIZADO'">
                    <i class="fa-solid fa-pen-to-square"></i> Editar
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
        }
      </div>
      }

      <!-- Formulario de edición de marcador (cuando hay partido seleccionado) -->
      @if (partidoSeleccionado) {
      <div class="marcador-formulario">
        <div class="partido-info mb-4 p-3" style="background: rgba(255,255,255,0.05); border-radius: 10px;">
          <h4 class="text-center mb-3" style="color: goldenrod;">
            <i class="fa-solid fa-futbol me-2"></i>{{ partidoSeleccionado.estadio }}
          </h4>
          
          <div class="row text-center">
            <div class="col-5">
              <h5>{{ getNombreEquipo(partidoSeleccionado.equipoA.id) }}</h5>
            </div>
            
            <div class="col-2" style="color:goldenrod;">
              <h3>VS</h3>
            </div>
            
            <div class="col-5">
              <h5>{{ getNombreEquipo(partidoSeleccionado.equipoB.id) }}</h5>
            </div>
          </div>
          
          <div class="row mt-3 text-center">
            <div class="col-12">
              <p class="mb-1" style="color: goldenrod;">
                <i class="fa-solid fa-calendar me-2"></i>
                {{ formatearFecha(partidoSeleccionado.fecha) }}
              </p>
              <p class="mb-0" style="color: goldenrod;">
                <i class="fa-solid fa-location-dot me-2"></i>
                {{ partidoSeleccionado.ciudad }}
              </p>
            </div>
          </div>
        </div>

        <!-- Formulario de marcador -->
<form [formGroup]="marcadorForm" class="marcador-edicion">
  <h5 class="text-center mb-4" style="color: goldenrod;">
    <i class="fa-solid fa-scoreboard me-2"></i>Actualizar Marcador
  </h5>
  
  <div class="row align-items-center justify-content-center">
    <!-- Equipo A -->
    <div class="col-md-4 text-center">
      <h6 class="mb-3" style="color: #4CAF50;">
        {{ getNombreEquipo(partidoSeleccionado.equipoA.id) }}
      </h6>
      
      <div class="contador-goles">
        <button type="button" class="btn-contador btn-decremento" 
                (click)="decrementarGoles('equipoA')"
                [disabled]="marcadorForm.get('golesEquipoA')?.value === 0">
          <i class="fa-solid fa-minus"></i>
        </button>
        
        <div class="display-goles">
          <span class="numero-goles">{{ marcadorForm.get('golesEquipoA')?.value || 0 }}</span>
        </div>
        
        <button type="button" class="btn-contador btn-incremento" 
                (click)="incrementarGoles('equipoA')"
                [disabled]="!unGolA">
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
      
      <small class="text-muted mt-2 d-block">Click +/- para ajustar</small>
    </div>

    <!-- Separador -->
    <div class="col-md-1 text-center">
      <h2 class="separador" style="color: goldenrod; margin-top: 40px;">-</h2>
    </div>

    <!-- Equipo B -->
    <div class="col-md-4 text-center">
      <h6 class="mb-3" style="color: #2196F3;">
        {{ getNombreEquipo(partidoSeleccionado.equipoB.id ) }}
      </h6>
      
      <div class="contador-goles">
        <button type="button" class="btn-contador btn-decremento" 
                (click)="decrementarGoles('equipoB')"
                [disabled]="marcadorForm.get('golesEquipoB')?.value === 0">
          <i class="fa-solid fa-minus"></i>
        </button>
        
        <div class="display-goles">
          <!-- CORRECCIÓN IMPORTANTE: Cambia golesEquipo2 por golesEquipoB -->
          <span class="numero-goles">{{ marcadorForm.get('golesEquipoB')?.value || 0 }}</span>
        </div>
      
        <button type="button" class="btn-contador btn-incremento" 
                (click)="incrementarGoles('equipoB')"
                [disabled]="!unGolB">
            <i class="fa-solid fa-plus"></i>
          </button>
        
      </div>
      
      <small class="text-muted mt-2 d-block">Click +/- para ajustar</small>
    </div>
  </div>

  <!-- Resumen del marcador -->
  <div class="row mt-4">
    <div class="col-12 text-center">
      <div class="resumen-marcador p-3" style="background: rgba(255,255,255,0.05); border-radius: 10px;">
        <h5 style="color: goldenrod; margin-bottom: 10px;">
          <i class="fa-solid fa-flag me-2"></i>Marcador Final
        </h5>
        <h3 class="mb-0">
          <span style="color: #4CAF50;">{{ marcadorForm.get('golesEquipoA')?.value || 0 }}</span>
          <span style="color: goldenrod; margin: 0 15px;">-</span>
          <span style="color: #2196F3;">{{ marcadorForm.get('golesEquipoB')?.value || 0 }}</span>
        </h3>
      </div>
    </div>
  </div>

  <!-- Validación -->
  <div class="row mt-3">
    <div class="col-12 text-center">
      <!-- CORRECCIÓN: Mensajes de validación correctos -->
      @if (marcadorForm.get('golesEquipoA')?.invalid && marcadorForm.get('golesEquipoA')?.touched) {
      <div class="text-danger">
        <i class="fa-solid fa-exclamation-circle"></i> Goles del equipo A inválidos (máx. 20)
      </div>
      }
      @if (marcadorForm.get('golesEquipoB')?.invalid && marcadorForm.get('golesEquipoB')?.touched) {
      <div class="text-danger">
        <i class="fa-solid fa-exclamation-circle"></i> Goles del equipo B inválidos (máx. 20)
      </div>
      }
      
      <!-- Información adicional -->
      <div class="text-info mt-2">
        <i class="fa-solid fa-info-circle"></i> Máximo 20 goles por equipo
      </div>
    </div>
  </div>
</form>

<!-- Botones de acción SIMPLIFICADOS -->
<div class="modal-actions mt-4">
  <button type="button" class="btn-cancelar" 
          (click)="partidoSeleccionado = null">
    <i class="fa-solid fa-arrow-left me-2"></i> Volver a la lista
  </button>
  <button type="button" class="btn-guardar" 
          (click)="guardarMarcador()"
          [disabled]="marcadorForm.invalid">
    <i class="fa-solid fa-save me-2"></i> Guardar Cambios
  </button>
</div>
      </div>
      }
    </div>
  </div>
</div>
}
